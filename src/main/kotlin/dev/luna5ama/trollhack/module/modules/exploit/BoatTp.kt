package dev.luna5ama.trollhack.module.modules.exploit

import baritone.api.utils.Helper
import dev.luna5ama.trollhack.module.Category
import dev.luna5ama.trollhack.module.Module
import net.minecraft.entity.item.EntityBoat
import net.minecraft.network.play.client.CPacketVehicleMove

internal object BoatTp : Module(
    name = "BoatTp",
    description = "Allows you to teleport with a boat",
    category = Category.EXPLOIT,
    modulePriority = 200
) {
    private val loopCount = setting("Loop Count", 4, 1..10, 1)
    private val y1 = setting("Desync Value", 0.1f, 0.1f..0.9f, 0.1f)
    private val y2 = setting("Teleport Distance", 130.0f, 1.0f..300f, 10f)

    init {
        onEnable {
            try {
                val player = Helper.mc.player ?: return@onEnable
                val boat = player.ridingEntity as? EntityBoat ?: run {
                    disable()
                    return@onEnable
                }
                val originalPos = boat.positionVector
                boat.setPosition(boat.posX, boat.posY + y1.value, boat.posZ)
                val groundPacket = CPacketVehicleMove(boat)
                boat.setPosition(boat.posX, boat.posY + y2.value, boat.posZ)
                val skyPacket = CPacketVehicleMove(boat)
                boat.setPosition(originalPos.x, originalPos.y, originalPos.z)
                repeat(loopCount.value) {
                    player.connection.sendPacket(skyPacket)
                    player.connection.sendPacket(groundPacket)
                }
                player.connection.sendPacket(CPacketVehicleMove(boat))
            } catch (e: Exception) {
                e.printStackTrace()
            } finally {
                disable()
            }
        }
    }
}